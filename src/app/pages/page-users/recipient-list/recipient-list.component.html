<div class="d-flex align-items-center justify-content-between">
    <!-- <div class="mr-3">
        <input type="text" class="form-control" placeholder="Search" [(ngModel)]="searchValue">
    </div>
    <button class="btn btn-primary" (click)="searchRecipient()">Filter</button> -->

    <app-search-box (searchEvent)="searchRecipient($event)"></app-search-box>

    <div>
        <button class="btn roboto-medium-16 white-text blue-2-bg add-recipient"
            [routerLink]="'../recipient/register'">Add Recipient</button>
    </div>
</div>

<div class="d-flex justify-content-end pt-1">
    <!-- <a href="javascript:void(0)" (click)="downloadRecipientTemplate()" role="link" class=" blue-text mr-3">
        <i class="fa fa-download" aria-hidden="true"></i>&nbsp;Download
    </a> -->
    <div (click)="openUploadDialog(uploadDialog)" class=" mr-3 blue-text cursor-pointer">
        <i class="fa fa-file-excel-o" aria-hidden="true"></i>&nbsp;Bulk Import
    </div>
    <!-- <div class="blue-text cursor-pointer">
        <i class="fa fa-cogs mr-1" aria-hidden="true"></i>Change Columns
    </div> -->
</div>

<div class="mb-5">
    <table class="table table-striped">
        <thead class="blue-2-bg white-text">
            <tr>
                <th class="txt roboto-regular-18 text-left">Recipient</th>
                <th class="txt roboto-regular-18 text-left">DOB</th>
                <!-- <th class="txt roboto-regular-18 text-left">Status</th> -->
                <th class="txt roboto-regular-18 text-left">Email</th>
                <th class="txt roboto-regular-18 text-left">Vaccine</th>
                <th class="txt roboto-regular-18 text-center">Action</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let User of RecipientDataList; let i =index">
                <td class="txt blue-text roboto-medium-16 text-left blue-text">{{User.fname}} {{User.lname}}</td>
                <td class="txt blue-text roboto-medium-16 text-left blue-text">{{User.dob|formatDate}}</td>
                <!-- <td class="txt blue-text roboto-medium-16 text-left blue-text">{{User.is_activated?'Active':'Inactive'}}
                </td> -->
                <td class="txt blue-text roboto-medium-16 text-left blue-text">{{User.email}}</td>
                <td class="txt blue-text roboto-medium-16 text-left blue-text">{{User.$expanded.materials.length ?
                    User.$expanded.materials[0].material_name:""}}</td>
                <td class="txt blue-text roboto-medium-16 text-left blue-text">
                    <div class="d-flex align-items-center justify-content-center">
                        <button (click)="recipientEdit(User)" type="button"
                            class="btn btn-outline-primary roboto-regular-12 mr-2">
                            Edit <i class="fa fa-pencil-square-o"></i>
                        </button>
                        <button type="button" class="btn btn-outline-primary roboto-regular-12"
                            (click)="recipientInfo = User['mobile_number']" (click)="onDelete(confirmDialog, User)">
                            Delete <i class="fa fa-trash-o"></i>
                        </button>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <div class="d-flex justify-content-between">
        <small class="text-muted roboto-regular-12">
            Showing {{(pageIndex -1) * pageLength + 1}} to {{totalCount > (pageLength * pageIndex) ?(pageLength *
            pageIndex)
            : totalCount }} of {{totalCount}}
            entries</small>
        <ngb-pagination class="ml-auto" (pageChange)="onPageChange($event)" [maxSize]="5" [page]="pageIndex"
            [pageSize]="pageLength" [collectionSize]="totalCount"></ngb-pagination>
    </div>
</div>

<ng-template #confirmDialog let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-title">Please confirm</h4>
        <button type="button" class="close" aria-describedby="modal-title" (click)="modal.dismiss('Cross click')">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <p><strong>Are you sure you want to delete this recipient?</strong></p>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="modal.close('Ok click')">Ok</button>
    </div>
</ng-template>

<ng-template #uploadDialog let-modal>
    <!-- <div *ngIf="uploading" class="spinner-overlay">
        <mat-spinner></mat-spinner>
    </div> -->
    <div class="modal-header">
        <h4 class="modal-title">Upload list</h4>
        <button type="button" class="close" (click)="modal.dismiss()">&times;</button>
    </div>
    <div class="modal-body modalbox" style="height: 400px;">
        <form enctype="multipart/form-data" style="text-align: center;">
            <div class="dropzone" Filedrapanddrop (filesChangeEmiter)="gotFileFromLocal($event)">
                <div class="text-wrapper">
                    <div class="centered">
                        <input type="file" accept=".csv" name="file" id="file" (change)="gotFileFromLocal($event.target.files)" >
                        <label for="file"><span id="hand"  value="Button" class="textLink">Select your file</span> or Drop files here!</label>
                    </div>
                </div>
            </div>
        </form>

        <div *ngFor="let f of files; let ind = index"
        class="row mt-1" style="height:20px;">
        <div class="col-4 d-none col-md-4 d-md-block"></div>

        <div class=" d-flex
                     align-items-center
                     h4">

            <div>{{f.name}}</div>
        </div>
        </div>
        {{failureMessage}}
        <br>
        <p *ngIf="successStatus">
            Success: Some rows were processed successfully. If you want to check the processed rows click
            <a href="javascript:void(0)" (click)="downloadMyFile('success')">here</a>
            to download the success file
        </p>
        <br>
        <p *ngIf="failureStatus">
            Error: Some rows could not be process as there seems to be some issue. Click
            <a href="javascript:void(0)" (click)="downloadMyFile('failed')">here</a>
            to download the failure file.
        </p>
        <br>
        <p style="text-align: center; font-size: 16px;">
            You can upload CSV file format. Download <a href="javascript:void(0)" (click)="downloadRecipientTemplate()">Sample</a> file </p>
    </div>
    <div class="modal-footer">
        <button type="submit" class="btn roboto-medium-18 btn-primary" (click)="uploadCSVFile()">
            Submit
        </button>
        <button type="button" class="btn roboto-medium-18 btn-outline-secondary" (click)="modal.dismiss()">
            Cancel
        </button>
    </div>
</ng-template>
<app-component-footer-copyright-strip></app-component-footer-copyright-strip>
