<app-component-dynamic-heading [heading]="'Appointment'" [refererClick]="true"></app-component-dynamic-heading>
<div class="container vaccinator-list-container" id="site-recp-list">
    <div class="d-flex align-items-center justify-content-between pt-3 table-action-strip">
        <div class="d-flex align-items-center">
            <mat-form-field appearance="outline" class="search-form-field">
                <mat-label>Search Recipient</mat-label>
                <input matInput (keyup)="checkIFBlankLoadData(searchInput)" #searchInput
                    (keyup.enter)="applyFilter(searchInput)" />
                <button mat-button *ngIf="searchInput.value.trim() !=''" matSuffix mat-icon-button aria-label="Clear"
                    (click)="(searchInput.value='');applyFilter(searchInput)">
                    <mat-icon>close</mat-icon>
                </button>
            </mat-form-field>
            <button type="button" class="btn roboto-medium-16 white-text blue-2-bg py-1 ml-3"
                (click)="applyFilter(searchInput)">Filter</button>
        </div>
        <div class="d-flex align-items-center">
            <button type="button" class="btn roboto-medium-16 white-text blue-2-bg py-1 ml-3"
                (click)="openBulkAppointmentDialog()">
                Bulk Appointments
            </button>
            <button type="button" class="btn roboto-medium-16 white-text blue-2-bg py-1 ml-3"
                (click)="openManagePrivateSlotsDialog()">
                Enable Private Slots
            </button>
            <button type="button" class="btn roboto-medium-16 white-text blue-2-bg py-1 ml-3" (click)="openDialog()">
                <i class="fa fa-book" aria-hidden="true"></i>&nbsp;Book Appointments&nbsp;&nbsp;
            </button>
            <button type="button" class="btn roboto-medium-16 white-text blue-2-bg py-1 ml-3"
                [routerLink]="'/site-admin/new-registration'">
                +&nbsp;New Registration&nbsp;&nbsp;
            </button>
        </div>


    </div>
    <div class="d-flex justify-content-end pt-2">
        <!-- <a href="javascript:void(0)" (click)="downloadRecipientTemplate()" role="link" class=" blue-text mr-3">
        <i class="fa fa-download" aria-hidden="true"></i>&nbsp;Download
    </a> -->
        <div (click)="openUploadDialog(uploadDialog)" class=" mr-3 blue-text cursor-pointer">
            <i class="fa fa-file-excel-o" aria-hidden="true"></i>&nbsp;Bulk Import
        </div>
        <!-- <div class="blue-text cursor-pointer">
        <i class="fa fa-cogs mr-1" aria-hidden="true"></i>Change Columns
    </div> -->
    </div>
    <div class="row">
        <div class="col w-100">

            <table mat-table MatSort [dataSource]="dataSource" matSort class="mat-elevation-z8">


                <ng-container matColumnDef="input_check_box">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header class="roboto-regular-18">
                        <mat-checkbox color="primary" (change)="checkUncheckAll($event)"></mat-checkbox>
                    </th>
                    <td mat-cell *matCellDef="let element" class="roboto-medium-16 blue-text">
                        <ng-container *ngIf="disableControl(element); then disabledTemplate else enabledTemplate">
                        </ng-container>
                        <ng-template #disabledTemplate>
                            <mat-checkbox color="primary" [value]="element.id" [disabled]="true" [readonly]="true"
                                #children>
                            </mat-checkbox>
                        </ng-template>
                        <ng-template #enabledTemplate>
                            <mat-checkbox color="primary" [value]="element.id" [checked]="checkAll" [readonly]="true"
                                #children>
                            </mat-checkbox>
                        </ng-template>
                    </td>
                </ng-container>

                <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header class="roboto-regular-18"> Recipient
                    </th>
                    <td mat-cell *matCellDef="let element" class="roboto-medium-16 blue-text"> {{element.name}}
                    </td>
                </ng-container>
                <ng-container matColumnDef="dob">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header class="roboto-regular-18"> DOB
                    </th>
                    <td mat-cell *matCellDef="let element" class="roboto-medium-16 blue-text">
                        {{getValidDate(element.dob)}}
                    </td>
                </ng-container>
                <ng-container matColumnDef="slottime">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header class="roboto-regular-18"> Slot Time </th>
                    <td mat-cell *matCellDef="let element" class="roboto-medium-16 blue-text">
                        {{element.slotTime ? (element.slotTime | date: 'h:mm a') : ''}}
                    </td>
                </ng-container>
                <ng-container matColumnDef="vaccine">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header class="roboto-regular-18"> Vaccine </th>
                    <td mat-cell *matCellDef="let element" class="roboto-medium-16 blue-text">
                        {{element?.vaccine}}
                    </td>
                </ng-container>
                <ng-container matColumnDef="date">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header class="roboto-regular-18"> Date </th>
                    <td mat-cell *matCellDef="let element" class="roboto-medium-16 blue-text">
                        {{element.date ? (element.date | formatDate) : '' }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="dose">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header class="roboto-regular-18"> Dose </th>
                    <td mat-cell *matCellDef="let element" class="roboto-medium-16 blue-text">
                        <!-- {{element.$expanded.booked_visits.length > 0 ? element.$expanded.booked_visits[0].dose_in_series
                        : '' }} -->
                        {{element?.dose}}
                    </td>
                </ng-container>

                <ng-container matColumnDef="survey">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header class="roboto-regular-18">Survey#</th>
                    <td mat-cell *matCellDef="let element" class="roboto-medium-16 blue-text">
                        {{element?.surveyId}}
                    </td>
                </ng-container>

                <ng-container matColumnDef="status">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header class="roboto-regular-18"> Status </th>
                    <td mat-cell *matCellDef="let element" class="roboto-medium-16 blue-text">
                        {{element.status | titlecase}}
                    </td>
                </ng-container>


                <ng-container matColumnDef="id">
                    <th mat-header-cell *matHeaderCellDef class="roboto-regular-18 text-center">Action </th>
                    <td mat-cell *matCellDef="let element" width="300" class="text-right">
                        <button *ngIf="!element.is_activated" class="btn btn-outline-primary roboto-regular-12 mr-2"
                            (click)="onInvite(element, inviteDialog)">
                            <b> {{ element.inviteStatus === 'sent' ? 'Reinvite' : 'Invite' }}</b>
                        </button>
                        <button class="btn btn-outline-primary roboto-regular-12 mr-2"
                            (click)="appointmentClick(element)">Appointment</button>
                        <button type="button" class="btn btn-outline-primary roboto-regular-12 mr-2"
                            [routerLink]="['/site-admin/edit-recepient',element.id]"><b>Edit&nbsp;<i
                                    class="fa fa-pencil-square-o"></i></b></button>

                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
        </div>
        <mat-paginator class="w-100" [length]="totalCount" [pageIndex]="pageIndex" (page)="getPageRecpient($event)"
            [pageSizeOptions]="opt" [pageSize]="pageSize" showFirstLastButtons></mat-paginator>
    </div>

    <div class="modal fade" id="exampleModal2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabe2"
        aria-hidden="true">
        <div class="modal-dialog border-0 h-auto delete-popup" role="document">
            <div class="modal-content">
                <div class="modal-header d-flex justify-content-center">
                    <h3 class="modal-title m-0 text-center roboto-regular-16" id="exampleModalLabe2">Delete Seat</h3>
                </div>
                <div class="modal-body">
                    <p class="roboto-regular-14 text-center m-0 pt-2 pb-4">Are you sure you want to delete seat </p>
                </div>
                <div class="modal-footer p-0 d-flex justify-content-around align-items-center">
                    <button data-dismiss="modal" aria-label="Close" type="button"
                        class="btn w-50 px-0 rounded-0 shadow-none m-0 border-right blue-text">No</button>
                    <button data-dismiss="modal" aria-label="Close" type="button"
                        class="btn w-50 px-0 rounded-0 shadow-none m-0 blue-text">Yes</button>
                </div>
            </div>
        </div>
    </div>
</div>

<ng-template #inviteDialog let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-title">Invite User</h4>
        <button type="button" class="close" aria-describedby="modal-title" (click)="modal.dismiss('Cross click')">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <p>
            Please select email or mobile for user name
        </p>

        <input type="radio" id="user_type_email" name="login_type" value="email" class="mr-2"
            [(ngModel)]="recipientToInvite.userType" [disabled]="!recipientToInvite.email">
        <label for="user_type_email">
            Email ({{recipientToInvite.email || 'N/A'}})
        </label><br>
        <input type="radio" id="user_type_phone" name="login_type" value="phone" class="mr-2"
            [(ngModel)]="recipientToInvite.userType" [disabled]="!recipientToInvite.mobile_number">
        <label for="user_type_phone">
            Phone ({{recipientToInvite.mobile_number || 'N/A'}})
        </label><br>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="modal.close('Ok click')"
            [disabled]="!recipientToInvite.userType">Invite</button>
    </div>
</ng-template>


<ng-template #confirmDialog let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-title">Please confirm</h4>
        <button type="button" class="close" aria-describedby="modal-title" (click)="modal.dismiss('Cross click')">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <p><strong>Are you sure you want to delete this recipient?</strong></p>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="modal.close('Ok click')">Ok</button>
    </div>
</ng-template>

<ng-template #uploadDialog let-modal>
    <!-- <div *ngIf="uploading" class="spinner-overlay">
      <mat-spinner></mat-spinner>
  </div> -->
    <div class="modal-header">
        <h4 class="modal-title">Upload list</h4>
        <button type="button" class="close" (click)="modal.dismiss()">&times;</button>
    </div>
    <div class="modal-body modalbox" style="height: 400px;">
        <form enctype="multipart/form-data" style="text-align: center;">
            <div class="dropzone" SiteAdminDragandDrop (filesChangeEmiter)="gotFileFromLocal($event)">
                <div class="text-wrapper">
                    <div class="centered">
                        <input type="file" accept=".csv" name="file" id="file"
                            (change)="gotFileFromLocal($event.target.files)">
                        <label for="file"><span id="hand" value="Button" class="textLink">Select your file</span> or
                            Drop files here!</label>
                    </div>
                </div>
            </div>
        </form>

        <div *ngFor="let f of files; let ind = index" class="row mt-1" style="height:20px;">
            <div class="col-4 d-none col-md-4 d-md-block"></div>

            <div class=" d-flex
                   align-items-center
                   h4">

                <div>{{f.name}}</div>
            </div>
        </div>
        {{failureMessage}}
        <br>
        <p *ngIf="successStatus">
            Success: Some rows were processed successfully. If you want to check the processed rows click
            <a href="javascript:void(0)" (click)="downloadMyFile('success')">here</a>
            to download the success file
        </p>
        <br>
        <p *ngIf="failureStatus">
            Error: Some rows could not be process as there seems to be some issue. Click
            <a href="javascript:void(0)" (click)="downloadMyFile('failed')">here</a>
            to download the failure file.
        </p>
        <br>
        <p style="text-align: center; font-size: 16px;">
            You can upload CSV file format. Download <a href="javascript:void(0)"
                (click)="downloadRecipientTemplate()">Sample</a> file </p>
    </div>
    <div class="modal-footer">
        <button type="submit" class="btn roboto-medium-18 btn-primary" (click)="uploadCSVFile()">
            Submit
        </button>
        <button type="button" class="btn roboto-medium-18 btn-outline-secondary" (click)="modal.dismiss()">
            Cancel
        </button>
    </div>
</ng-template>
<app-component-footer-copyright-strip></app-component-footer-copyright-strip>